<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic models ¬∑ StochasticPrograms.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">StochasticPrograms.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quickstart/">Quick start</a></li><li><a class="tocitem" href="../data/">Stochastic data</a></li><li class="is-active"><a class="tocitem" href>Stochastic models</a><ul class="internal"><li><a class="tocitem" href="#[@stage](@ref)-blocks"><span><code>@stage</code> blocks</span></a></li><li><a class="tocitem" href="#[@parameters](@ref)-blocks"><span><code>@parameters</code> blocks</span></a></li><li><a class="tocitem" href="#[@decision](@ref)-blocks"><span><code>@decision</code> blocks</span></a></li><li><a class="tocitem" href="#[@recourse](@ref)-blocks"><span><code>@recourse</code> blocks</span></a></li><li><a class="tocitem" href="#[@known](@ref)-blocks"><span><code>@known</code> blocks</span></a></li><li><a class="tocitem" href="#[@uncertain](@ref)-blocks"><span><code>@uncertain</code> blocks</span></a></li><li><a class="tocitem" href="#Model-instantiation"><span>Model instantiation</span></a></li><li><a class="tocitem" href="#Instant-models"><span>Instant models</span></a></li><li><a class="tocitem" href="#SMPS"><span>SMPS</span></a></li></ul></li><li><a class="tocitem" href="../decisions/">Decision API</a></li><li><a class="tocitem" href="../distributed/">Distributed stochastic programs</a></li><li><a class="tocitem" href="../structuredsolvers/">Structured solvers</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public interface</a></li><li><a class="tocitem" href="../../library/solverinterface/">Solver interface</a></li><li><a class="tocitem" href="../../library/crash/">Crash</a></li><li><a class="tocitem" href="../../library/lshaped/">L-shaped solvers</a></li><li><a class="tocitem" href="../../library/progressivehedging/">Progressive-hedging solvers</a></li><li><a class="tocitem" href="../../library/quasigradient/">Quasi-gradient solvers</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Stochastic models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/martinbiel/StochasticPrograms.jl/blob/master/docs/src/manual/model.md" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Stochastic-models"><a class="docs-heading-anchor" href="#Stochastic-models">Stochastic models</a><a id="Stochastic-models-1"></a><a class="docs-heading-anchor-permalink" href="#Stochastic-models" title="Permalink"></a></h1><p>The <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> command is now introduced in more detail. The discussion will as before revolve around the simple example introduced in the <a href="../quickstart/#Quick-start">Quick start</a>:</p><pre><code class="language-julia hljs">@stochastic_model simple_model begin
    @stage 1 begin
        @decision(simple_model, x‚ÇÅ &gt;= 40)
        @decision(simple_model, x‚ÇÇ &gt;= 20)
        @objective(simple_model, Min, 100*x‚ÇÅ + 150*x‚ÇÇ)
        @constraint(simple_model, x‚ÇÅ + x‚ÇÇ &lt;= 120)
    end
    @stage 2 begin
        @known(simple_model, x‚ÇÅ, x‚ÇÇ)
        @uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ
        @recourse(simple_model, 0 &lt;= y‚ÇÅ &lt;= d‚ÇÅ)
        @recourse(simple_model, 0 &lt;= y‚ÇÇ &lt;= d‚ÇÇ)
        @objective(simple_model, Max, q‚ÇÅ*y‚ÇÅ + q‚ÇÇ*y‚ÇÇ)
        @constraint(simple_model, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
        @constraint(simple_model, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
    end
end</code></pre><p>Note, that the resulting model object is stored in <code>simple_model</code>, and that the same name is used to reference the stochastic program in the <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks. The following anonymous syntax is also supported:</p><pre><code class="language-julia hljs">simple_model = @stochastic_model begin
    @stage 1 begin
        @decision(model, x‚ÇÅ &gt;= 40)
        @decision(model, x‚ÇÇ &gt;= 20)
        @objective(model, Min, 100*x‚ÇÅ + 150*x‚ÇÇ)
        @constraint(model, x‚ÇÅ + x‚ÇÇ &lt;= 120)
    end
    @stage 2 begin
        @known(model, x‚ÇÅ, x‚ÇÇ)
        @uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ
        @recourse(model, 0 &lt;= y‚ÇÅ &lt;= d‚ÇÅ)
        @recourse(model, 0 &lt;= y‚ÇÇ &lt;= d‚ÇÇ)
        @objective(model, Max, q‚ÇÅ*y‚ÇÅ + q‚ÇÇ*y‚ÇÇ)
        @constraint(model, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
        @constraint(model, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
    end
end</code></pre><p>where the reserved keyword <code>model</code> is used in the <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks.</p><h2 id="[@stage](@ref)-blocks"><a class="docs-heading-anchor" href="#[@stage](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks</a><a id="[@stage](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@stage](@ref)-blocks" title="Permalink"></a></h2><p>The body of a <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> definition consists of a number of <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks, following the syntax:</p><pre><code class="language-julia hljs">@stage N begin
    ...
end</code></pre><p>Here, <code>N</code> is the stage number and the body is made up of <a href="https://github.com/JuliaOpt/JuMP.jl">JuMP</a> syntax as well as <a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a>, <a href="../../library/public/#StochasticPrograms.@decision"><code>@decision</code></a>, and <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> blocks. At least two stages must be defined and the stages must be defined in consecutive order starting with the first stage. The number of stage blocks included in the <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> definition determines the number of stages that a stochastic program instantiated from the resulting stochastic model will have.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It is possible to define and instantiate stochastic models with more than two stages. However, most internal tools and solvers only support two-stage models at this point.</p></div></div><h2 id="[@parameters](@ref)-blocks"><a class="docs-heading-anchor" href="#[@parameters](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a> blocks</a><a id="[@parameters](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@parameters](@ref)-blocks" title="Permalink"></a></h2><p>The <a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a> blocks are used to introduce deterministic parameters to a <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> block. See for example <a href="../data/#Stage-data">Stage data</a>. The following:</p><pre><code class="language-julia hljs">@parameters a b</code></pre><p>makes the constants <code>a</code> and <code>b</code> available as model parameters. This incurs a promise that those parameters will be injected when instantiating the model, and if no default values are available they must be supplied by the user. In other words, if <code>sm</code> is a stochastic model that includes the above <a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a> annotation in one of its <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks, then those parameters must be supplied as keyword arguments when instantiating stochastic programs using this model:</p><pre><code class="language-julia hljs">instantiate(sm, scenarios, a = 1, b = 2)</code></pre><p>Alternatively, default values can be specified directly in the <a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a> block:</p><pre><code class="language-julia hljs">@parameters begin
    a = 1
    b = 2
end</code></pre><p>Values supplied to <a href="../../library/public/#StochasticPrograms.instantiate-Tuple{StochasticModel{2, P} where P&lt;:Tuple{StageParameters, StageParameters}, Vector{var&quot;#s77&quot;} where var&quot;#s77&quot;&lt;:AbstractScenario}"><code>instantiate</code></a> are always used, and otherwise the default values are used. The responsibility is on the user to ensure that the supplied parameters support the operations used in the <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks. Parameters can be reused in multiple blocks, but each occurance must be annotated by <a href="../../library/public/#StochasticPrograms.@parameters"><code>@parameters</code></a> in each of the stages.</p><h2 id="[@decision](@ref)-blocks"><a class="docs-heading-anchor" href="#[@decision](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@decision"><code>@decision</code></a> blocks</a><a id="[@decision](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@decision](@ref)-blocks" title="Permalink"></a></h2><p>The <a href="../../library/public/#StochasticPrograms.@decision"><code>@decision</code></a> blocks are used to annotate linking variables between stages. Their usage is identical syntax-wise to JuMP&#39;s <code>@variable</code> macros. Internally, they create specialized JuMP variables with context-dependent behaviour.</p><h2 id="[@recourse](@ref)-blocks"><a class="docs-heading-anchor" href="#[@recourse](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@recourse"><code>@recourse</code></a> blocks</a><a id="[@recourse](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@recourse](@ref)-blocks" title="Permalink"></a></h2><p>The <a href="../../library/public/#StochasticPrograms.@recourse"><code>@recourse</code></a> macro functions like the <a href="../../library/public/#StochasticPrograms.@decision"><code>@decision</code></a> macro, but is only used to annotate recourse decisions in the final stage.</p><h2 id="[@known](@ref)-blocks"><a class="docs-heading-anchor" href="#[@known](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@known"><code>@known</code></a> blocks</a><a id="[@known](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@known](@ref)-blocks" title="Permalink"></a></h2><p>A <a href="../../library/public/#StochasticPrograms.@known"><code>@known</code></a> annotation is used in subsequent stages to bring a decision defined in a previous stage into scope. Any decision defined by <a href="../../library/public/#StochasticPrograms.@decision"><code>@decision</code></a> inside a <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> automatically annotates subsequent stages with appropriate <a href="../../library/public/#StochasticPrograms.@known"><code>@known</code></a> lines.</p><p>The <a href="../../library/public/#StochasticPrograms.@known"><code>@known</code></a> block in the simple example above is given by</p><pre><code class="language-julia hljs">@known(simple_moel, x‚ÇÅ, x‚ÇÇ)</code></pre><p>This states that the second stage of the stochastic model depends on the decisions <code>x‚ÇÅ</code> and <code>x‚ÇÇ</code> taken in the previous stage. Note again that this lines is implicitly added by <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> and is not required.</p><h2 id="[@uncertain](@ref)-blocks"><a class="docs-heading-anchor" href="#[@uncertain](@ref)-blocks"><a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> blocks</a><a id="[@uncertain](@ref)-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#[@uncertain](@ref)-blocks" title="Permalink"></a></h2><p>The <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> blocks are used to annotate stochastic data in the stochastic model. For flexibility, there are several different ways of doing this. However, an <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> annotation is always connected to some <a href="../../library/public/#StochasticPrograms.AbstractScenario"><code>AbstractScenario</code></a> type, as introduced in <a href="../data/#Scenario-data">Scenario data</a>. Note, that a <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> block can only include one <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> block. All stochastic information in a given stage must therefore be captured in the <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> block of that stage.</p><p>The most simple approach is to use leverage the <a href="../../library/public/#StochasticPrograms.Scenario"><code>Scenario</code></a> type. Consider the <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> annotation given above:</p><pre><code class="language-julia hljs">@uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ</code></pre><p>This will ensure that <a href="../../library/public/#StochasticPrograms.Scenario"><code>Scenario</code></a>s that are expected to have the fields <code>q‚ÇÅ</code>, <code>q‚ÇÇ</code>, <code>d‚ÇÅ</code> and <code>d‚ÇÇ</code> are injected when constructing second-stage models. Each such scenario must be supplied or sampled using a supplied sampler object. It is the responsibility of the user to ensure that each supplied or sampled <a href="../../library/public/#StochasticPrograms.Scenario"><code>Scenario</code></a> has the correct fields. For example, the following yields a <a href="../../library/public/#StochasticPrograms.Scenario"><code>Scenario</code></a> compatible with the above <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> line:</p><pre><code class="language-julia hljs">Scenario(q‚ÇÅ = 24.0,
         q‚ÇÇ = 28.0,
         d‚ÇÅ = 500.0,
         d‚ÇÇ = 100.0,
         probability = 0.4)</code></pre><p>Alternatively, the same scenario is conveniently created using the <a href="../../library/public/#StochasticPrograms.@scenario"><code>@scenario</code></a> macro, matching the syntax of the <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> declaration:</p><pre><code class="language-julia hljs">@scenario q‚ÇÅ = 24.0 q‚ÇÇ = 28.0 d‚ÇÅ = 500.0 d‚ÇÇ = 100.0 probability = 0.4</code></pre><p>We can also use JuMP&#39;s container syntax:</p><pre><code class="language-julia hljs">@uncertain Œæ[1:5]
@uncertain Œæ[i in 1:5]
@uncertain Œæ[i in 1:5, i != 3]
@uncertain Œæ[i in 1:5, j in 1:5]
@uncertain Œæ[i in 1:5, k in [:a,:b,:c]]</code></pre><p>and then use the a corresponding formulation in the <a href="../../library/public/#StochasticPrograms.@scenario"><code>@scenario</code></a> macro to generate scenarios:</p><pre><code class="language-julia hljs">Œæ = @scenario Œæ[1:5] = rand(5) probability = rand()
Œæ = @scenario Œæ[i in 1:5] i * rand() probability = rand()
Œæ = @scenario Œæ[i in 1:5, i != 3] i * rand() probability = rand()
Œæ = @scenario Œæ[i in 1:5, j in 1:5] = rand(5,5) probability = rand()
Œæ = @scenario Œæ[i in 1:5, k in [:a,:b,:c]] = rand(5,5) probability = rand()</code></pre><p>Note, that we above sometimes assign the full random vector directly, and sometimes provide an indexed based formula.</p><p>As shown in <a href="../data/#Stochastic-data">Stochastic data</a>, it is also possible to introduce other scenario types, either using <a href="../../library/public/#StochasticPrograms.@define_scenario"><code>@define_scenario</code></a> or manally as explained in <a href="../data/#Custom-scenarios">Custom scenarios</a> and demonstrated in the <a href="../examples/#Continuous-scenario-distribution">Continuous scenario distribution</a> example. If we instead define the necessary scenario structure as follows:</p><pre><code class="language-julia hljs">@define_scenario SimpleScenario = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end</code></pre><p>One can then use:</p><pre><code class="language-julia hljs">@uncertain Œæ::SimpleScenario</code></pre><p>and extract the required fields from <code>Œæ</code> which will be of type <code>SimpleScenario</code> after data injection. Again, it is the responsibility of the user to supply scenarios of this type when instantiating the model. For example, the following constructs a <code>SimpleScenario</code> compatible with the above <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> line:</p><pre><code class="language-julia hljs">SimpleScenario(-24.0, -28.0, 500.0, 100.0, probability = 0.4)</code></pre><p>It is also possible to directly unpack the necessary fields using the following syntactic sugar:</p><pre><code class="language-julia hljs">@uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from SimpleScenario</code></pre><p>The actual scenario instance can still be annotated and used if necessary:</p><pre><code class="language-julia hljs">@uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from Œæ::SimpleScenario</code></pre><p>Finally, if the <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> block is used within a <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> environment, it is possible to simultaneosly define the underlying scenario type. In other words,</p><pre><code class="language-julia hljs">@uncertain Œæ::SimpleScenario = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end</code></pre><pre><code class="language-julia hljs">@uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from SimpleScenario = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end</code></pre><p>and</p><pre><code class="language-julia hljs">@uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from Œæ::SimpleScenario = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end</code></pre><p>are all possible methods of defining and using the <code>SimpleScenario</code> type in a <code>@stage</code> block.</p><h2 id="Model-instantiation"><a class="docs-heading-anchor" href="#Model-instantiation">Model instantiation</a><a id="Model-instantiation-1"></a><a class="docs-heading-anchor-permalink" href="#Model-instantiation" title="Permalink"></a></h2><p>A model object <code>sm</code> defined using <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> can be used to instantiate stochastic programs over both finite/infinite sample spaces and discrete/continuous random variables.</p><p>If the scenarios are associated with a discrete random variable over a finite sample space, then the corresponding stochastic program is finite and can be instantiated by providing the full list of scenarios:</p><pre><code class="language-julia hljs">sp = instantiate(sm, scenarios)</code></pre><p>Here, <code>scenarios</code> is a vector of scenarios consistent with the <a href="../../library/public/#StochasticPrograms.@uncertain"><code>@uncertain</code></a> annotation used in the second stage of <code>sm</code>. It is the responsibility of the user to ensure that the individual probabilities of the <code>scenarios</code> sum up to one, so that the model is consistent.</p><p>If the scenarios are instead associated with a continuous random variable, with finite second moments, over an infinite sample space, then the corresponding stochastic program is not finite and must be approximated. The only supported way of doing so in StochasticPrograms is by using sampled average approximations. A finite stochastic program that approximates the stochastic model is obtained through</p><pre><code class="language-julia hljs">sp = instantiate(sm, sampler, n)</code></pre><p>where <code>sampler</code> is an <a href="../../library/public/#StochasticPrograms.AbstractSampler"><code>AbstractSampler</code></a>, as outlined in <a href="../data/#Sampling">Sampling</a>, and <code>n</code> is the number of samples to include.</p><h2 id="Instant-models"><a class="docs-heading-anchor" href="#Instant-models">Instant models</a><a id="Instant-models-1"></a><a class="docs-heading-anchor-permalink" href="#Instant-models" title="Permalink"></a></h2><p>It is possible to create one-off stochastic programs without needing to first define a model object. To do so, any required scenario data structure must be defined first. Consider:</p><pre><code class="language-julia hljs">using StochasticPrograms

@define_scenario SimpleScenario = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end
Œæ‚ÇÅ = SimpleScenario(-24.0, -28.0, 500.0, 100.0, probability = 0.4)
Œæ‚ÇÇ = SimpleScenario(-28.0, -32.0, 300.0, 300.0, probability = 0.6)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimpleScenario with probability 0.6
  q‚ÇÅ: -28.0
  q‚ÇÇ: -32.0
  d‚ÇÅ: 300.0
  d‚ÇÇ: 300.0</code></pre><p>Next, an unmodeled stochastic program can be instantiated using the two created scenarios:</p><pre><code class="language-julia hljs">sp = StochasticProgram([Œæ‚ÇÅ, Œæ‚ÇÇ], Deterministic())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Deferred stochastic program with 2 scenarios</code></pre><p>Note that we must provide the instantiation type explicitly as well. A slightly diferrent modeling syntax is now used to define the stage models of <code>sp</code>:</p><pre><code class="language-julia hljs">@first_stage sp = begin
    @decision(sp, x‚ÇÅ &gt;= 40)
    @decision(sp, x‚ÇÇ &gt;= 20)
    @objective(sp, Min, 100*x‚ÇÅ + 150*x‚ÇÇ)
    @constraint(sp, x‚ÇÅ + x‚ÇÇ &lt;= 120)
end
@second_stage sp = begin
    @known(sp, x‚ÇÅ, x‚ÇÇ)
    @uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from SimpleScenario
    @recourse(sp, 0 &lt;= y‚ÇÅ &lt;= d‚ÇÅ)
    @recourse(sp, 0 &lt;= y‚ÇÇ &lt;= d‚ÇÇ)
    @objective(sp, Min, q‚ÇÅ*y‚ÇÅ + q‚ÇÇ*y‚ÇÇ)
    @constraint(sp, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
    @constraint(sp, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
end</code></pre><p>Here, <code>@first_stage</code> and <code>@second_stage</code> are just syntactic sugar for <code>@stage 1</code> and <code>@stage 2</code>. Note, that the model name <code>sp</code> must be used internally in the <a href="../../library/public/#StochasticPrograms.@stage"><code>@stage</code></a> blocks when referencing the model. This is is the definition syntax used internally by <code>StochasticModel</code> objects when instantiating stochastic programs. Note, that we must explicitly add the <code>@known</code> annotations to the second stage with this approach, while models created using <a href="../../library/public/#StochasticPrograms.@stochastic_model"><code>@stochastic_model</code></a> does this automatically. We can verify that this approach yields the same stochastic program by printing and comparing to the <a href="../quickstart/#Quick-start">Quick start</a>:</p><pre><code class="language-julia hljs">print(sp)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Deterministic equivalent problem
Min 100 x‚ÇÅ + 150 x‚ÇÇ - 9.600000000000001 y‚ÇÅ‚ÇÅ - 11.200000000000001 y‚ÇÇ‚ÇÅ - 16.8 y‚ÇÅ‚ÇÇ - 19.2 y‚ÇÇ‚ÇÇ
Subject to
 x‚ÇÅ ‚àà Decisions
 x‚ÇÇ ‚àà Decisions
 y‚ÇÅ‚ÇÅ ‚àà RecourseDecisions
 y‚ÇÇ‚ÇÅ ‚àà RecourseDecisions
 y‚ÇÅ‚ÇÇ ‚àà RecourseDecisions
 y‚ÇÇ‚ÇÇ ‚àà RecourseDecisions
 x‚ÇÅ ‚â• 40.0
 x‚ÇÇ ‚â• 20.0
 y‚ÇÅ‚ÇÅ ‚â• 0.0
 y‚ÇÇ‚ÇÅ ‚â• 0.0
 y‚ÇÅ‚ÇÇ ‚â• 0.0
 y‚ÇÇ‚ÇÇ ‚â• 0.0
 x‚ÇÅ + x‚ÇÇ ‚â§ 120.0
 -60 x‚ÇÅ + 6 y‚ÇÅ‚ÇÅ + 10 y‚ÇÇ‚ÇÅ ‚â§ 0.0
 -80 x‚ÇÇ + 8 y‚ÇÅ‚ÇÅ + 5 y‚ÇÇ‚ÇÅ ‚â§ 0.0
 -60 x‚ÇÅ + 6 y‚ÇÅ‚ÇÇ + 10 y‚ÇÇ‚ÇÇ ‚â§ 0.0
 -80 x‚ÇÇ + 8 y‚ÇÅ‚ÇÇ + 5 y‚ÇÇ‚ÇÇ ‚â§ 0.0
 y‚ÇÅ‚ÇÅ ‚â§ 500.0
 y‚ÇÇ‚ÇÅ ‚â§ 100.0
 y‚ÇÅ‚ÇÇ ‚â§ 300.0
 y‚ÇÇ‚ÇÇ ‚â§ 300.0
Solver name: No optimizer attached.</code></pre><p>As a side note, it is possible to run stage definition macros on programs with existing models. This overwrites the previous model and upon regeneration all internal problems. For example, the following increases the lower bound on the second stage variables to 2:</p><pre><code class="language-julia hljs">@stage 2 sp = begin
    @known(sp, x‚ÇÅ, x‚ÇÇ)
    @uncertain q‚ÇÅ q‚ÇÇ d‚ÇÅ d‚ÇÇ from SimpleScenario
    @recourse(sp, 2 &lt;= y‚ÇÅ &lt;= d‚ÇÅ)
    @recourse(sp, 2 &lt;= y‚ÇÇ &lt;= d‚ÇÇ)
    @objective(sp, Min, q‚ÇÅ*y‚ÇÅ + q‚ÇÇ*y‚ÇÇ)
    @constraint(sp, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
    @constraint(sp, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
end

generate!(sp)

print(sp)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Deterministic equivalent problem
Min 100 x‚ÇÅ + 150 x‚ÇÇ - 9.600000000000001 y‚ÇÅ‚ÇÅ - 11.200000000000001 y‚ÇÇ‚ÇÅ - 16.8 y‚ÇÅ‚ÇÇ - 19.2 y‚ÇÇ‚ÇÇ
Subject to
 x‚ÇÅ ‚àà Decisions
 x‚ÇÇ ‚àà Decisions
 y‚ÇÅ‚ÇÅ ‚àà RecourseDecisions
 y‚ÇÇ‚ÇÅ ‚àà RecourseDecisions
 y‚ÇÅ‚ÇÇ ‚àà RecourseDecisions
 y‚ÇÇ‚ÇÇ ‚àà RecourseDecisions
 x‚ÇÅ ‚â• 40.0
 x‚ÇÇ ‚â• 20.0
 y‚ÇÅ‚ÇÅ ‚â• 2.0
 y‚ÇÇ‚ÇÅ ‚â• 2.0
 y‚ÇÅ‚ÇÇ ‚â• 2.0
 y‚ÇÇ‚ÇÇ ‚â• 2.0
 x‚ÇÅ + x‚ÇÇ ‚â§ 120.0
 -60 x‚ÇÅ + 6 y‚ÇÅ‚ÇÅ + 10 y‚ÇÇ‚ÇÅ ‚â§ 0.0
 -80 x‚ÇÇ + 8 y‚ÇÅ‚ÇÅ + 5 y‚ÇÇ‚ÇÅ ‚â§ 0.0
 -60 x‚ÇÅ + 6 y‚ÇÅ‚ÇÇ + 10 y‚ÇÇ‚ÇÇ ‚â§ 0.0
 -80 x‚ÇÇ + 8 y‚ÇÅ‚ÇÇ + 5 y‚ÇÇ‚ÇÇ ‚â§ 0.0
 y‚ÇÅ‚ÇÅ ‚â§ 500.0
 y‚ÇÇ‚ÇÅ ‚â§ 100.0
 y‚ÇÅ‚ÇÇ ‚â§ 300.0
 y‚ÇÇ‚ÇÇ ‚â§ 300.0
Solver name: No optimizer attached.</code></pre><p>It is of course also possible to do this on programs instantiated from a <code>StochasticModel</code>.</p><h2 id="SMPS"><a class="docs-heading-anchor" href="#SMPS">SMPS</a><a id="SMPS-1"></a><a class="docs-heading-anchor-permalink" href="#SMPS" title="Permalink"></a></h2><p>StochasticPrograms also support reading models specified in the SMPS format. Specifically, SMPS definitions with uncertain data of types INDEP or BLOCKS are supported. We show how the simple example can be specified in SMPS. An SMPS definition consist of the following files:</p><ul><li>problem.smps</li><li>problem.tim</li><li>problem.cor</li><li>problem.sto</li></ul><p>Here, <code>problem.smps</code> is just an empty file that shares the name with the others to simplify IO commands. The <code>problem.tim</code> file specifies the stage structure of the stochastic program. An example for the simple problem is given below.</p><pre><code class="nohighlight hljs">TIME          SIMPLE
PERIODS
    X1        BOUND                    STAGE1
    Y1        LINK1                    STAGE2
ENDATA</code></pre><p>Row and column delimeters are given for each stage. The <code>problem.cor</code> file specifies the optimization structure of the problem in MPS format. An example for the simple problem as follows.</p><pre><code class="nohighlight hljs">NAME          SIMPLE
ROWS
 N  OBJ
 L  BOUND
 L  LINK1
 L  LINK2
 L  Y1UP
 L  Y2UP
COLUMNS
    X1        OBJ       100.0          BOUND     1.0
    X2        OBJ       150.0          BOUND     1.0
    X1        LINK1     -60.0
    X2        LINK2     -80.0
    Y1        OBJ       26.0           Y1UP      1.0
    Y2        OBJ       30.0           Y2UP      1.0
    Y1        LINK1     6.0            LINK2     8.0
    Y2        LINK1     10.0           LINK2     5.0
RHS
    RHS       BOUND     120.0
    RHS       LINK1     0.0
    RHS       LINK2     0.0
    RHS       Y1UP      400.0
    RHS       Y2UP      200.0
BOUNDS
 LO X1LIM     X1        40.0
 LO X2LIM     X2        20.0
 LO Y1LIM     Y1        0.0
 LO Y2LIM     Y2        0.0
ENDATA</code></pre><p>Finally, the <code>problem.sto</code> file specifies the uncertain data. We use the BLOCKS format to specify the simple scenarios.</p><pre><code class="nohighlight hljs">STOCH         SIMPLE
BLOCKS        DISCRETE
 BL BLOCK1    STAGE2    0.4
    Y1        OBJ       -24.0
    Y2        OBJ       -28.0
    RHS       Y1UP      500.0
    RHS       Y2UP      100.0
 BL BLOCK1    STAGE2    0.6
    Y1        OBJ       -28.0
    Y2        OBJ       -32.0
    RHS       Y1UP      300.0
    RHS       Y2UP      300.0
ENDATA</code></pre><p>We specify the two scenarios, giving the value in each corresponding coordinate in the <code>problem.cor</code> file. Now, we can read this model into Julia in several ways, assuming all files are in the same folder. First, consider</p><pre><code class="language-julia hljs">model = read(&quot;problem.smps&quot;, StochasticModel)</code></pre><pre><code class="language-julia hljs">Two-Stage Stochastic Model

minimize f‚ÇÄ(x) + ùîº[f(x,Œæ)]
  x‚ààùí≥

where

f(x,Œæ) = min  f(y; x, Œæ)
              y ‚àà ùí¥ (x, Œæ)</code></pre><p>This returns a <code>StochasticModel</code> object that can be used as usual, assuming it is instantiated with the scenarios of the special <code>SMPSScenario</code> type. To that end, we can read a specialized sampler object for the specified SMPS model:</p><pre><code class="language-julia hljs">sampler = read(&quot;problem.smps&quot;, SMPSSampler)
sampler()</code></pre><pre><code class="language-julia hljs">SMPSScenario with probability 1.0 and underlying data:

Œîq = [0.0, 0.0, -54.0, -62.0]
ŒîT = 0√ó2 SparseArrays.SparseMatrixCSC{Float64,Int64} with 0 stored entries
ŒîW = 0√ó2 SparseArrays.SparseMatrixCSC{Float64,Int64} with 0 stored entries
Œîh = Float64[]
ŒîC = 4√ó4 SparseArrays.SparseMatrixCSC{Float64,Int64} with 0 stored entries
Œîd‚ÇÅ = [0.0, 0.0, 0.0, 0.0]
Œîd‚ÇÇ = [0.0, 0.0, -100.0, 100.0]</code></pre><p>We can now instantiate a specific instance of the read model:</p><pre><code class="language-julia hljs">sp = instantiate(model, sampler, 2)</code></pre><pre><code class="language-julia hljs">Stochastic program with:
 * 2 decision variables
 * 2 recourse variables
 * 2 scenarios of type SMPSScenario
Structure: Deterministic equivalent
Solver name: No optimizer attached.</code></pre><p>The same result, up to sampling, can be achieved directly through</p><pre><code class="language-julia hljs">sp = read(&quot;problem.smps&quot;, StochasticProgram, num_scenarios = 2)</code></pre><pre><code class="language-julia hljs">Stochastic program with:
 * 2 decision variables
 * 2 recourse variables
 * 2 scenarios of type SMPSScenario
Structure: Deterministic equivalent
Solver name: No optimizer attached.</code></pre><p>This <code>read</code> variant takes the same keyword arguments as <code>instantiate</code>. Because the specified scenario structure in BLOCKS or INDEP format has finite support, it is possible to read the stochastic program corresponding to the full support by not specifying <code>num_scenarios</code>:</p><pre><code class="language-julia hljs">sp = read(&quot;problem.smps&quot;, StochasticProgram)</code></pre><pre><code class="language-julia hljs">Stochastic program with:
 * 2 decision variables
 * 2 recourse variables
 * 2 scenarios of type SMPSScenario
Structure: Deterministic equivalent
Solver name: No optimizer attached.</code></pre><p>In this case, the full support correspond exactly to the simple model we have considered before:</p><pre><code class="language-julia hljs">print(sp)</code></pre><pre><code class="language-julia hljs">Deterministic equivalent problem
Min 100 x[1] + 150 x[2] - 16.8 y‚ÇÇ[1] - 19.2 y‚ÇÇ[2] - 9.600000000000001 y‚ÇÅ[1] - 11.200000000000001 y‚ÇÅ[2]
Subject to
 y‚ÇÅ[1] ‚â• 0.0
 y‚ÇÅ[2] ‚â• 0.0
 y‚ÇÇ[1] ‚â• 0.0
 y‚ÇÇ[2] ‚â• 0.0
 [x[1], x[2]] ‚àà Decisions
 x[1] ‚â• 40.0
 x[2] ‚â• 20.0
 [x[1] + x[2] - 120] ‚àà MathOptInterface.Nonpositives(1)
 [-60 x[1] + 6 y‚ÇÅ[1] + 10 y‚ÇÅ[2], -80 x[2] + 8 y‚ÇÅ[1] + 5 y‚ÇÅ[2], y‚ÇÅ[1] - 500, y‚ÇÅ[2] - 100] ‚àà MathOptInterface.Nonpositives(4)
 [-60 x[1] + 6 y‚ÇÇ[1] + 10 y‚ÇÇ[2], -80 x[2] + 8 y‚ÇÇ[1] + 5 y‚ÇÇ[2], y‚ÇÇ[1] - 300, y‚ÇÇ[2] - 300] ‚àà MathOptInterface.Nonpositives(4)
Solver name: No optimizer attached.</code></pre><p>A warning is issued if the full support contains more than <code>1e5</code> scenarios.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../data/">¬´ Stochastic data</a><a class="docs-footer-nextpage" href="../decisions/">Decision API ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Monday 13 December 2021 14:42">Monday 13 December 2021</span>. Using Julia version 1.6.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
